<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<title>Citation</title>
<link rel="icon" type="image/gif" href="animated_favicon1.gif">

<noscript>Please enable Javascript to view this page correctly.</noscript>
<script type="text/javascript" src="src/brython.js"></script>
<script src="Scripts/angular.min.js"></script>     
<script src="Scripts/Script.js"></script> 
<!--link rel="shortcut icon" href="/favicon.ico"-->
<script type="text/python3" id = "brython">
import re


def readdata(filename):
  file = open(filename+'.xml','r+')
  content = file.read()
  file.close()
  #findi(content)
  result = a.findall(content)
  return result

def readdict():
  with open('report_hde01.txt') as f:
    lines = f.read().splitlines()
  f.close()
  return lines

def updatefile(filename,k,v):
  with open(filename+'.xml','r+') as f:
    content = f.read()
    update = content.replace(k,k+' '+v)
    f.write(update)
    f.close()
  
  
def unmatched(k):
  with open('UNMATCHED.txt') as file:
    file.write(k + "\n")
  file.close()
    
    
def updatedict(k,v):
  with open('UNMATCHED.txt') as f:
    f.write(k)
    
    
UNQLIST,KVP,matches,LIST,unmatch= [],[],{},[],{}
a = re.compile('<I>([^<]+v.[^<]+)</I>', re.IGNORECASE)
b = re.compile('</XREF>([^<]+)', re.IGNORECASE)
c = re.compile('(<XREF[^>]*>[^<]+</XREF>)', re.IGNORECASE)
d = re.compile("(\w+)",re.IGNORECASE)
#print(readdata(file))

PVP = readdata('15954')
for item in PVP:
  data = ''.join(d.findall(item))
  data1= data.replace('See','').replace('see','')
  UNQLIST.append((item.replace('See','').replace('see',''),data1))
  LIST.append(data1)

#print(UNQLIST)
  
dictionary = readdict()
#print(dictionary)

for item in dictionary:
  key = b.findall(item)
  unqkey = key[0].replace('\t','')
  value = c.findall(item)
  #unqkey = ''.join(d.findall(key[0]))
  KVP.append((unqkey,value[0]))##
  
DICT = dict(KVP)
#print(DICT)

for i in UNQLIST:
  if i[1] in DICT:
    key = UNQLIST[0]
    matches[key] = DICT[key]
    updatefile('15954',key,matches[key])
  else:
    unmatched(i[0])

</script>


<title><link rel="shortcut icon"  href="images/cite.ico" /> Cite</title>
<link rel="stylesheet" href="doc/doc_brython.css">
</head>
<!--  
options:
  debug: can equal 0,1,2.  more verbose as number increases
  cache: 'none', 'version', 'browser'.
         'none' - no caching allowed. a new random number is appended to end of each request
         'version' - caching allowed for each new brython version
         'browser' - nothing is appended to request.  A clients browser is responsible for caching actions.
  pythonpath: a list of additional urls/paths to search for modules
-->
<body onload="brython({debug:1, ipy_id:['brython'], args:['arg1', 'arg2','arg3']})" ng-app="myApp">
<nav class="navbar navbar-inverse navbar-fixed-top navclass" id="main-navbar" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
        <span class="sr-only"> Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div> <!-- end navbar header-->

  <div class="collapse navbar-collapse" id="nav">
  <ul class= "nav navbar-nav">
  <li>
  <a href ="#"><span class="glyphicon glyphicon-home" style = "font-size:2em; color: cyan;"/></span></a>
  </li>
  </ul>  
  <button type="button" class="btn btn-info pull-right" data-toggle="modal" data-target="#myModal" >LOGIN</button>
  </div>
    </div> <!-- end container-->
  </nav> <!-- End of navigation -->


<br>
<div class= "container-fluid">
<div class = "jumbotron text-center">
 <img src="images/jumbo.png" alt="CITE">
</div>
</div>

    <div class = "container-fluid" >
    <div class = "row">
    <div class = " col-xs-12  col-xs-offset-3 col-sm-6  col-md-offset-4 col-md-4 col-lg-offset-5 col-lg-2">

    <div class="dropdown">
      <button class="btn btn-info btn-lg dropdown-toggle" type="button" data-toggle="dropdown">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Select Product &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
      <span class="caret"></span></button>
      <ul class="dropdown-menu" id="ddl">
        <li class = "text-center"><a href="#">HDE</a></li>
        <li class = "text-center"><a href="#">PLR</a></li>
        <li class = "text-center"><a href="#">HED</a></li>
      </ul>
    </div> 
    </div>
    </div>
    </div>
    <br><hr>
    <br><br>

    <div class = "container-fluid text-center" ng-controller="myCtrl">
    <form action="brython.php" method="post" enctype="multipart/form-data" class = "text-center">

    <center><h4>Select xml file to upload:</h4><br>
    <input type="file" name="fileToUpload" id="fileSelected"><br></center>
    <button type= "button" class= "submit btn-lg btn-info" ng-click="">UPLOAD XML</button>
</form>
</div>


<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">LOGIN</h4>
      </div>
      <div class="modal-body">
        <form role="form">
    <div class="form-group">
      <label for="username">USERNAME:</label>
      <input type="text" class="form-control" id="uname" placeholder="Enter Username">
    </div>
    <div class="form-group">
      <label for="pwd">PASSWORD:</label>
      <input type="password" class="form-control" id="pwd" placeholder="Enter Password">
    </div>
    <div class="checkbox">
      <label><input type="checkbox"> Remember me</label>
    </div>
  </form>
      </div>
      <div class="modal-footer text-center">
        <button type="button" class="login btn btn-default" data-dismiss="modal">Login</button>
      </div>
    </div>
    <!-- modal ends here-->

<!-- Modal -->
<div id="unmatched" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">UNMATCHED RECORDS</h4>
      </div>
      <div class="modal-body">
        <div class = "container-fluid">
        <table class = "striped">
        <th>
        PVP
        </th>
        <th>
        Citation
        </th>
        <tr>
        <I>Thomas V. Winchester</I>
        </tr>
        <tr>
        <input type = "textbox" id = "citedata" placeholder = "Enter Citation">
        </tr>
        </table>
        </div>
      </div>
      <div class="modal-footer text-center">
        <div class ="container-fluid" >
          <h3>This is an example of pager with anchor tags</h3>

          <ul class= "pager">
            <li class="disabled"><a href="#">&laquo; Prev</a></li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li class="disabled"><a href="#">Next &raquo;</a></li>
          </ul>  
          </div>
          <hr>
        <button type="button" class="submit btn btn-default" data-dismiss="modal">Submit</button>
      </div>
    </div>
<script>

/*var app = angular.module('fileDemo', []);

app.directive('fdInput', ['$timeout', function ($timeout) {
    return {
        link: function (scope, element, attrs) {
            element.on('change', function  (evt) {
                var files = evt.target.files;
                console.log(files[0].name);
                console.log(files[0].size);
            });
        }
    }
}]);*/

angular.module('myApp', [])
.controller('myCtrl', ['$scope', function($scope) {
    $('#fileSelected').on('click', function (evt) {
    var files = $(evt.currentTarget).get(0).files;

    if(files.length > 0) {
        $('#fileName').text(files[0].name);
        $('#fileSize').text(files[0].size);
        $('#filePath').text($('#fileSelected').val());
        alert (fileName,fileSize,filePath);
    }
    });
}]);
</script>
  </div>
</div>
</body>
</html>